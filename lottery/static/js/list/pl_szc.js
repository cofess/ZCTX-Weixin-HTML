CP.PL=function(){var lotteryType=$("#content_home").children().eq(0).attr("id").replace("buy_","");var hasTouch="ontouchstart"in window;var start_ev=hasTouch?"touchstart":"mousedown";var end_ev=hasTouch?"touchend":"mouseup";var s={p5:{red:9,miniRedNum:1,maxRedNum:11,count:5,lot_id:"52",name:"排列五"},qxc:{red:9,miniRedNum:1,maxRedNum:11,count:7,lot_id:"51",name:"七星彩"}};var last_update=0;var g={zhushu:0,beishu:1,qishu:1,totalMoney:0,zhuijia:2,codes:"",buyType:1,loty_id:s[lotteryType].lot_id,qihao_id:"",hmMoney:""};var o={pageGo:{goBack:function(){TopAnch.init({title:s[lotteryType].name,prevShow:true,prevFun:function(){window.location.href="#type=index"},menu:[{name:"投注选号",url:"javascript:;",cur:true},{name:"开奖结果",url:"#type=url&p=kj/result.html?in_="+s[lotteryType].lot_id,cur:false},{name:"玩法帮助",url:"#type=url&p=wf/"+lotteryType+".html",cur:false}],style:false})}},clickBall:function(_this,on,lotteryType){$(_this).is("."+on)?$(_this).removeClass(on):$(_this).addClass(on);o.countTotal()},highLight:function(arr,dom){o.clear($(dom+" b"));for(var j=0,l1=_arr.length;j<l1;j++){$(dom+" b").eq(parseInt(_arr[j],10)-1).addClass("red")}},clear:function(dom){dom.each(function(){$(this).removeClass()});o.countTotal()},jxNum:function(n,type){if(type){for(var i=1;i<=n;i++){if(lotteryType=="qxc"){var red=CP.math.random(0,9,7,true)}else{var red=CP.math.random(0,9,5,true)}var _code="";_code+=red;o.addToList([_code,1]);o.countAll()}window.scrollTo(0,1);o.setLocal()}else{if(lotteryType=="qxc"){var red=CP.Util.padArray(CP.math.random(0,9,7,true))}else{var red=CP.Util.padArray(CP.math.random(0,9,5,true))}o.clear($("#qxc .jxsscxhBall b"));for(var j=0,l1=red.length;j<l1;j++){$("#qxc .jxsscxhBall").eq(j).find("p").find("b").eq(parseInt(red[j],10)-1).addClass("red")}o.countTotal()}},getCode:function(dom){var _arr=[];for(var i=0;i<dom.find("p").find(".red").length;i++){_arr[i]=dom.find("p").find(".red").eq(i).text()}return _arr},addList:function(){if(!g.qihao_id){alert("期号获取失败!请刷新页面");return false}else if($("#Notes").text()=="0"){alert("至少选择一注");return false}else{var _arrRed=[];var _code="";if(lotteryType=="qxc"){var Q=o.getCode($("#qxc .jxsscxhBall").eq(0));var Q1=o.getCode($("#qxc .jxsscxhBall").eq(1));var Q2=o.getCode($("#qxc .jxsscxhBall").eq(2));var Q3=o.getCode($("#qxc .jxsscxhBall").eq(3));var Q4=o.getCode($("#qxc .jxsscxhBall").eq(4));var Q5=o.getCode($("#qxc .jxsscxhBall").eq(5));var Q6=o.getCode($("#qxc .jxsscxhBall").eq(6));_code=Q.join("")+","+Q1.join("")+","+Q2.join("")+","+Q3.join("")+","+Q4.join("")+","+Q5.join("")+","+Q6.join("")}else{var Q=o.getCode($("#qxc .jxsscxhBall").eq(0));var Q1=o.getCode($("#qxc .jxsscxhBall").eq(1));var Q2=o.getCode($("#qxc .jxsscxhBall").eq(2));var Q3=o.getCode($("#qxc .jxsscxhBall").eq(3));var Q4=o.getCode($("#qxc .jxsscxhBall").eq(4));_code=Q.join("")+","+Q1.join("")+","+Q2.join("")+","+Q3.join("")+","+Q4.join("")}if($("#countNotes").text()=="0"){$("#tbox_qishu").val("1");$("#tbox_beishu").val("1")}o.addToList([_code,g.zhushu]);window.location.href="#type=fun&fun=CP.PL.openList";o.setLocal()}},addToList:function(arr){var _html="";_html+='<div class="ssqtzNum">';_html+='<cite class="errorBg"><em class="error2"></em></cite>';_html+="<span><em>"+arr[0].replace(/,/g," ")+"</em>";_html+="</span>";_html+="<p>直选&nbsp;&nbsp;&nbsp;"+arr[1]+"注"+2*arr[1]+"元</p>";_html+='<input type="hidden" value="'+arr[1]+'" name="bet_num" class="bet-num">';_html+='<input type="hidden" value="'+arr[0]+'" name="bet" class="bet">';_html+="</div>";$("#bet_list").prepend(_html);o.clear($("#qxc .jxsscxhBall b"));$("#Notes").text(0);$("#Money").text(g.zhushu=0)},setLocal:function(){var codes=[];$("#bet_list .bet:input").each(function(){codes.push($(this).val())});g.codes=codes.join(";");CP.Storage.set(lotteryType,g.codes,true)},renderQihao:function(data){g.qihao_id=data.pid;var wk=["日","一","二","三","四","五","六"];var now=CP.calcTime(data.now,"+8");var et=data.atime;var severtime=now.getFullYear()+"-"+CP.Util.pad(now.getMonth()+1,2)+"-"+CP.Util.pad(now.getDate(),2);var et1=et.substr(11,5),et2=et.substr(0,10),et3=et.substr(5,6);var timeText="";timeText=CP.Util.dateDiff(severtime,et2);timeText={0:"今天",1:"明天",2:"后天"}[timeText]||et3;var tDATE=et.substr(0,10);tDATE=new Date(tDATE);var wk2="周"+wk[tDATE.getDay()];if(timeText!=""){$("#issue_info").html("第 "+data.pid+" 期 "+timeText+""+et1+"("+wk2+") 截止");return true}else{return false}},getQihao:function(callback){if(callback){$.ajax({url:"/trade/info.go?gid="+g.loty_id,dataType:"xml",cache:true,async:callback?false:true,success:function(xml){var data={},issueInfo=[],miss_={};var R=$(xml).find("rows");data.pid=R.attr("pid");data.atime=R.attr("atime");data.tn=R.attr("tn");data.now=new Date(arguments[2].getResponseHeader("Date"));o.renderQihao(data);var rp=R.find("rowp");rp.each(function(a){var t={};t.pid=$(this).attr("pid");t.acode=$(this).attr("acode");t.tn=$(this).attr("tn");issueInfo[a]=t});callback(issueInfo)},error:function(){$dom.$issueInfo.html("网络不通畅，请点击刷新");$dom.$issueInfo.bind(end_ev,function(){window.location.reload()})}})}else{return false}},getTime:function(){var kjhtml="";o.getQihao(function(data){var t=data.length,kjhtml="";for(var n=0;n<t;n++){var red=data[n].acode;red=red.replace(/,/g," ");kjhtml+='<ul><li class="wb20">'+data[n].pid.substr(4,3)+'期</li><li class="wb25"><span class="red">'+red+"</span></li></ul>"}$(".k3kjlist").html(kjhtml)})},openList:function(){var grade=parseInt(localStorage.getItem("grade"));if(grade>0){$("#dobuy").html("立即预约")}$("#betball,#bethm").hide();$("#betlist").show();$("#lot_footer").removeClass("fo_basket fo_hm").addClass("fo_buy");TopAnch.init({title:"投注列表",prevShow:true,prevFun:function(){window.location.href="#type=url&p=list/"+lotteryType+".html"},isBack:true,nextShow:false,style:false});o.countAll();window.scrollTo(0,1)},getArgument:function(t){var buy={};var code=CP.Util.joinString(g.loty_id,g.codes);switch(t){case 1:buy={payUrl:"/trade/pcast.go",gid:g.loty_id,pid:g.qihao_id,codes:code,muli:g.beishu,countMoney:g.totalMoney,orderType:"dg"};break;case 2:buy={payUrl:"/trade/pcast.go",gid:g.loty_id,pid:g.qihao_id,codes:code,muli:g.beishu,desc:$("#hmDesc").val()||"快乐购彩、欧耶！",countMoney:g.totalMoney,bnum:$("#rg").val(),pnum:$("#bd").val(),oflag:$("#isPublic .cur").attr("v")||0,wrate:$("#ratio .cur").attr("v")||5,orderType:"hm"};break;case 3:var muli="",pid=g.qihao_id;for(var i=0;i<g.qishu;i++){muli+=g.beishu+",";pid+=","}pid=pid.substring(0,pid.length-1);muli=muli.substring(0,muli.length-1);buy={payUrl:"/trade/zcast.go",gid:g.loty_id,pid:pid,codes:code,muli:muli,countMoney:g.totalMoney,zflag:$(".zjStop em").hasClass("nocheck")?"0":"1",orderType:"zh"};break}return buy},dopay:function(t){g.qishu=parseInt($("#tbox_qishu").val());g.qishu>1?g.buyType=3:t?g.buyType=2:g.buyType=1;var _obj=o.getArgument(g.buyType);var cMoney="";t?cMoney=g.hmMoney:cMoney=g.totalMoney;var data={gid:g.loty_id,cMoney:cMoney,payPara:_obj};alert("提交中，请稍后！","loading");CP.User.info(function(options){remove_alert();if(options){jQuery.extend(data,options)}CP.Popup.buybox(data)});sessionStorage.removeItem(lotteryType)},dobuy:function(t){var info="";if(g.zhushu<1){info="请至少选择一注彩票"}else if(!g.qishu){info="请输入期数"}else if(!g.beishu){info="请输入倍数"}if(info!=""){alert(info);return}if(t){window.location.href="#type=fun&fun=CP.PL.doHm"}else{o.dopay()}},hmDet:function(){var rg=parseInt($("#rg").val()||0);var bd=parseInt($("#bd").val()||0);var z=rg+bd;g.hmMoney=z;$("#hm_m cite:eq(0)").html(rg);$("#hm_m cite:eq(1)").html(bd);$("#hm_m cite:eq(2)").html(z)},doHm:function(){$("#betball,#betlist").hide();$("#bethm").show();$("#lot_footer").removeClass("fo_basket fo_buy").addClass("fo_hm");TopAnch.init({title:"发起合买",prevShow:true,prevFun:function(){window.location.href="#type=fun&fun=CP.PL.openList"},isBack:true,nextShow:false,style:false});$("#hmDet cite").eq(0).html(g.zhushu);$("#hmDet cite").eq(1).html(g.beishu);$("#hmDet cite").eq(2).html(g.totalMoney);$("#rg").val(Math.ceil(g.totalMoney*.05));$("#rg_bl").html(Math.floor($("#rg").val()/g.totalMoney*1e4)/100+"%");$("#bd").removeAttr("disabled");$("#bd").val("0");$("#bd_bl").html("0%");o.hmDet()},countAll:function(){var zhushu=0;g.beishu=$("#tbox_beishu").val();g.qishu=$("#tbox_qishu").val();var codes=[];$("#bet_list .bet-num").each(function(e){zhushu+=parseInt($(this).val());codes.push($(this).next().val())});g.codes=codes.join(";");$("#countNotes").html(g.zhushu=zhushu);$("#countMoney").html(g.totalMoney=g.zhushu*2*g.beishu*g.qishu)},countTotal:function(){var type=g.loty_id;var zs=0,c1,c2,c3,c4,c5,c6,c7;if(type=="52"){c1=$("#qxc div.jxsscxhBall:eq(0) p").find("b.red").length;c2=$("#qxc div.jxsscxhBall:eq(1) p").find("b.red").length;c3=$("#qxc div.jxsscxhBall:eq(2) p").find("b.red").length;c4=$("#qxc div.jxsscxhBall:eq(3) p").find("b.red").length;c5=$("#qxc div.jxsscxhBall:eq(4) p").find("b.red").length;g.zhushu=zs=c1*c2*c3*c4*c5;g.money=2*g.zhushu}else{c1=$("#qxc div.jxsscxhBall:eq(0) p").find("b.red").length;c2=$("#qxc div.jxsscxhBall:eq(1) p").find("b.red").length;c3=$("#qxc div.jxsscxhBall:eq(2) p").find("b.red").length;c4=$("#qxc div.jxsscxhBall:eq(3) p").find("b.red").length;c5=$("#qxc div.jxsscxhBall:eq(4) p").find("b.red").length;c6=$("#qxc div.jxsscxhBall:eq(5) p").find("b.red").length;c7=$("#qxc div.jxsscxhBall:eq(6) p").find("b.red").length;g.zhushu=zs=c1*c2*c3*c4*c5*c6*c7;g.money=2*g.zhushu}$("#Notes").html(g.zhushu);$("#Money").html(g.money);if(parseInt($("#Notes").html())>0){$("#Notes").addClass("red");$("#Money").addClass("red")}else{$("#Notes").removeClass("red");$("#Money").removeClass("red")}},fromLocal:function(){var _json=CP.Storage.get(lotteryType,true);if(_json){try{g.codes=_json;var codes=_json.split(";");for(var i=0,l=codes.length;i<l;i++){var _arr=codes[i].split("|");o.addToList([codes[i],CP.math.C(_arr[0].split(",").length,s[lotteryType]["miniRedNum"])*CP.math.C(_arr[1].split(",").length,s[lotteryType]["miniBlueNum"])])}o.countAll()}catch(e){sessionStorage.removeItem(lotteryType)}}}};var bind=function(){o.getTime();$("#qxc").find(".jxsscxhBall p b").bind("click",function(){o.clickBall(this,"red")});$("#shake").bind(start_ev,function(){o.jxNum(1,0)});$("#kj_slide").bind(start_ev,function(){if($(this).find(".ssqup").hasClass("ssqdown")){$(this).next().show()}else{$(this).next().hide()}$(this).find(".ssqup").toggleClass("ssqdown")});$("#deleted").bind(start_ev,function(){o.clear($("#qxc .jxsscxhBall p b"))});$("#addlist").bind("click",function(){o.addList()});$("#jxbtn").bind(start_ev,function(){o.jxNum(1,1)});$("#hand").bind(start_ev,function(){location.href="#type=url&p=list/"+lotteryType+".html"});$("#dobuy").bind(start_ev,function(){o.dobuy()});$("#dohm").bind(start_ev,function(){!$(this).hasClass("fqhmGray")&&o.dobuy("hm")});$("#hmSubmit").bind(start_ev,function(){if(parseInt($("#rg").val())<g.totalMoney*.05){return}o.dopay("hm")});$("#clearAll").bind(start_ev,function(){$("#bet_list").html("");$("#tbox_qishu").val("1");$("#tbox_beishu").val("1");CP.Storage.remove(lotteryType,true);o.countAll();if(g.qishu>1){$("#dohm").addClass("fqhmGray");$(".zjStop").show()}else{$("#dohm").removeClass("fqhmGray");$(".zjStop").hide()}});$("#bet_list").delegate(".errorBg",end_ev,function(){$(this).parent().remove();o.countAll();o.setLocal()});var buyTimes=1;var zuiqishuNum=1;$("#tbox_beishu").KeyBoard({val:buyTimes,max:lotteryType=="p5"?99:999,min:1,num:1,tag:"倍",fn:function(){g.beishu=$(this.ts).val();o.countAll()}});$("#tbox_qishu").KeyBoard({val:zuiqishuNum,max:30,min:1,num:1,tag:"期",fn:function(){g.qishu=$(this.ts).val();if(g.qishu>1){$("#dohm").addClass("fqhmGray");$(".zjStop").show()}else{$("#dohm").removeClass("fqhmGray");$(".zjStop").hide()}o.countAll()}});$(".zjStop").bind(start_ev,function(){$(this).find("em").toggleClass("nocheck check")});$("#rg").on("keyup",function(){var bd_=parseInt($("#bd").val());if($(this).val()>=g.totalMoney){$(this).val(g.totalMoney);$("#rg_bl").html("100%")}else{if($(this).val()==""){$("#rg_bl").html("0%")}else{$("#rg_bl").html(Math.floor(parseInt($("#rg").val())/g.totalMoney*1e4)/100+"%")}}if(!$("#chk").hasClass("nocheck")||parseInt($(this).val())+bd_>g.totalMoney){if($(this).val()==""){$("#bd").val(g.totalMoney);$("#bd_bl").html("100%")}else{$("#bd").val(g.totalMoney-parseInt($(this).val()));$("#bd_bl").html(Math.ceil(parseInt($("#bd").val())/g.totalMoney*1e4)/100+"%")}}o.hmDet()}).on("change",function(){var t=$(this).val();if(t==""){t=0}if(parseInt(t)<g.totalMoney*.05){alert("认购金额不能小于5%");$(this).val(Math.ceil(g.totalMoney*.05));$("#rg_bl").html(Math.floor(parseInt($("#rg").val())/g.totalMoney*1e4)/100+"%")}if(!$("#chk").hasClass("nocheck")){$("#bd").val(g.totalMoney-parseInt($(this).val()));$("#bd_bl").html(Math.ceil(parseInt($("#bd").val())/g.totalMoney*1e4)/100+"%")}o.hmDet()});$("#bd").on("keyup",function(){var rg_=parseInt($("#rg").val());parseInt($(this).val())>g.totalMoney-rg_&&$(this).val(g.totalMoney-rg_);if($(this).val()==""){$("#bd_bl").html("0%")}else{$(this).val(parseInt($(this).val()));$("#bd_bl").html(Math.ceil(parseInt($("#bd").val())/g.totalMoney*1e4)/100+"%")}o.hmDet()}).on("change",function(){if($(this).val()==""){$(this).val("0");$("#bd_bl").html("0%");o.hmDet()}});$("#chk").bind(start_ev,function(){var rg_=parseInt($("#rg").val());$(this).toggleClass("nocheck");if(!$("#chk").hasClass("nocheck")){$("#bd").attr("disabled",true);$("#bd").val(g.totalMoney-rg_);$("#bd_bl").html(Math.ceil(parseInt($("#bd").val())/g.totalMoney*1e4)/100+"%")}else{$("#bd").removeAttr("disabled")}o.hmDet()});$("#ratio li,#isPublic li").on(start_ev,function(){!$(this).hasClass("cur")&&$(this).toggleClass("cur");$(this).siblings().removeClass("cur")});Shake.run(function(){var curTime=(new Date).getTime();if(curTime-last_update>1500&&$("#betball").is(":visible")){$(".mask2").show();o.clear($("#qxc .jxsscxhBall p b"));imitate();last_update=curTime}})};var imitate=function(){var left_="5";if(lotteryType=="p5"){left_="17"}var ratio=(90/7).toFixed(2);var delay=.1;var tfb=delay*1e3*s[lotteryType].count+500;var red=CP.math.random(0,s[lotteryType].red,s[lotteryType].count,true);for(var i=1;i<=s[lotteryType].count;i++){$("body").append('<div class=ssq1 style="left:'+left_+"%;-webkit-animation-delay: "+delay*i+"s;animation-delay: "+delay*i+'s;">'+red[i-1]+"</div>");left_=parseFloat(left_)+parseFloat(ratio)}setTimeout(function(){goto_()},tfb)};var goto_=function(){var num,l,t,this_;var red=[];$(".ssq1").each(function(aa){num=$(this).text();this_=$("#qxc .jxsscxhBall").eq(aa);this_=this_.find("b:eq("+num+")");red.push(num);t=this_.offset().top;l=this_.offset().left;$(this).animate({left:l,top:t},300)});setTimeout(function(){for(var s in red){$("#qxc .jxsscxhBall:eq("+s+") b:eq("+red[s]+")").addClass("red")}$(".ssq1").remove();$(".mask2").hide();o.countTotal()},250)};var grade=function(){var grade=parseInt(localStorage.getItem("grade"));if(grade>0){$("#dobuy").html("立即预约")}};var init=function(){grade();o.fromLocal();o.pageGo.goBack();bind()};return{init:init,grade:grade,openList:o.openList,doHm:o.doHm,pageGo:o.pageGo}}();CP.PL.init();function resetPage(){CP.PL.grade();CP.PL.pageGo.goBack();$("#betball").show();$("#betlist,#bethm").hide();$("#lot_footer").removeClass("fo_buy fo_hm").addClass("fo_basket")}